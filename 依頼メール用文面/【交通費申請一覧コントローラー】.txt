【交通費申請一覧コントローラー】



☑設計書に明示的な実装手段を指定している部分の削除と修正
・シート【検索交通費申請情報】項目3　データ型変換の下り


ーーーーーーーーーーーーーーーーーーーーーーー


【交通費申請サービス】
・設計書に明示的な実装手段を指定している以下の部分の削除と修正
☑シート【初期表示データ取得交通費申請一覧】
削除：項目6　拡張for文使用の下り

☑シート【項目検索交通費申請一覧】　
削除：項目3　拡張for文使用の下り

☑シート【申請年取得】
削除：項目4　拡張for文使用の下り

・サービスで結合にあたる処理を行うという方法の、
結合にあたる詰め替えの実際の処理をMapを使用して行う仕様に変更しています。

・処理内容を抽象化して記載しています。
☑初期表示データ取得交通費申請一覧
☑項目検索交通費申請情報
☑申請年取得

シート【申請年取得】
☑呼び出し側の処理
・プロパティファイルから「最低表示年数」を取得します。
・処理によって得た「最低表示年数」と「検索範囲開始日」の
・業務日付から、取得した「最低表示年数」を引き算した年の1月1日を求め、【申請年取得】メソッドのFromへ指定し、検索条件に加えるという仕様に修正しています。


ーーーーーーーーーーーーーーーーーーーーーーーーーーーー

【コードマスタサービス】
☑コードマスタのデータ取得方法

・コードマスタから取得したコード分類に基づき、コードと表示名を取得しています。しかし、前回まではそのメソッドのパラメータは固定されていました。

・今回、他の機能でも利用できるように、引数を動的に指定できる仕様に変更しました。

・具体的には以下のようになっています。

1.引数にコード分類（例えば "地域コード", "部門コード" など）を受け取る。
2.各分類に対して、コードマスタを検索し、該当するコードと表示名のセットを取得。
3.それらをリストとしてまとめ、最終的にマップに分類ごとに格納して返す。

ーーーーーーーーーーーーーーーーーーーーーーーーーーーーー

【交通費申請マッパー】
【全シートに共通する修正】
☑コード結合処理の廃止し、サービス層での処理に委ねています。

☑引数のパラメータなのか、テーブルのカラム名なのかを区別するために
　　テーブル名には別名をつけました。

【項目検索交通費申請一覧】
☑引数2ｰ3　必須に○がついてるのに、選択無しとなっていました。

こちらの表記は消して選択なしの項目も消しました。
パラムオプジェクトからも同様に消しています。
選択無しが選択された結果を定数として定義していましたが、マッパーで条件文を追加するわけでもなく、他になにか処理を加えることもなかったため、選択無しの場合ただの空が入るというものに再定義しました。


☑同シート、処理仕様

	○○日 >= 引数.検索範囲開始日　　　　　　　　　（合計４個所）　

	承認ステータスコード=引数.承認ステータスコード　（１箇所）

先頭に「AND」を追記

シート【申請年取得】

☑交通費申請テーブルに登録されているすべての年を抽出を行わず、５年を保持する形で行う。

☑引数にFrom、Toを増やす。
・メインクエリの抽出条件にFromがNULLでなければFromを追加し、ToがNULLでなければToを追加するといった仕様にしました。

・Propertiesファイルを新規に作成する。
Propertiesファイルに「最低表示年数」を設定し、5としています。


ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー

【その他】

〇ほぼ全てのメソッドに「ログイン社員IDの存在確認」処理が入っていたため、
汎化を行いました。

・【コントローラ基底クラス_設計書】【サービス基底設計書_サービス基底クラス】
の２つを作成し、「ログイン社員IDの存在確認」の汎化を行いました。

・クラス種別を「abstract class」 クラス名を「コントローラ基底クラス」としています。
そして、呼び出したいサービスの継承クラスに「コントローラ基底クラス」を追加しました。

・【詳細設計書_ユーザマスタ_サービス】の設計書を削除しています。


〇ファイル名を以下のように変更しました。

☑詳細設計書_交通費申請一覧画面_画面設計書_WEB対応.xlsx　→　画面設計書_交通費申請一覧画面.xlsx
☑詳細設計書_交通費申請一覧画面_コントローラ.xlsx　→　コントローラー設計書_交通費申請一覧画面.xlsx
☑詳細設計書_交通費申請一覧画面_サービス.xlsx　→　サービス設計書_交通費申請一覧.xlsx　　※「画面」はつけない
☑詳細設計書_コードマスタ_サービス.xlsx　→　サービス設計書_コードマスタ.xlsx

☑詳細設計書_交通費申請一覧画面_マッパー.xlsx　→　マッパー設計書_交通費申請.xlsx　　※「一覧画面」はつけない
☑詳細設計書_コードマスタ_マッパー.xlsx　→　マッパー設計書_コードマスタ.xlsx
☑詳細設計書_ユーザマスタ_マッパー.xlsx　→　マッパー設計書_ユーザマスタ.xlsx

☑詳細設計書_ユーザマスタ_サービス.xlsx　→　サービス設計書_ユーザマスタ.xlsx
↑基底クラスサービスになったんでないです。

共通部品はコントローラー、サービス、マッパーのどれでも無いので、そのままとします。
詳細設計書_共通部品クラス.xlsx